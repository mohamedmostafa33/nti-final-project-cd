# Gateway Helm Chart Values
# Default values for reddit-gateway

# Namespace Configuration
namespace: default

# Gateway Configuration
gateway:
  enabled: true
  name: reddit-gateway
  gatewayClassName: nginx
  listeners:
    - name: http
      protocol: HTTP
      port: 80
      allowedRoutes:
        namespaces:
          from: All
    # Uncomment below for HTTPS support
    # - name: https
    #   protocol: HTTPS
    #   port: 443
    #   tls:
    #     mode: Terminate
    #     certificateRefs:
    #       - name: reddit-tls-secret
    #         kind: Secret
    #   allowedRoutes:
    #     namespaces:
    #       from: All

# Combined HTTPRoute for both frontend and backend
httproute:
  enabled: true
  name: reddit-httproute
  hostnames: []  # Set your hostname here, e.g., ["reddit.yourdomain.com"]
  rules:
    # API routes to backend
    - matches:
        - path:
            type: PathPrefix
            value: /api
      backendRefs:
        - name: reddit-backend-service
          namespace: reddit-app
          port: 8000
    # Admin routes to backend
    - matches:
        - path:
            type: PathPrefix
            value: /admin
      backendRefs:
        - name: reddit-backend-service
          namespace: reddit-app
          port: 8000
    # Static files from backend
    - matches:
        - path:
            type: PathPrefix
            value: /static
      backendRefs:
        - name: reddit-backend-service
          namespace: reddit-app
          port: 8000
    # Media files from backend
    - matches:
        - path:
            type: PathPrefix
            value: /media
      backendRefs:
        - name: reddit-backend-service
          namespace: reddit-app
          port: 8000
    # Prometheus metrics
    - matches:
        - path:
            type: PathPrefix
            value: /metrics
      backendRefs:
        - name: reddit-backend-service
          namespace: reddit-app
          port: 8000
    # All other routes to frontend (catch-all - must be last)
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: reddit-frontend-service
          namespace: reddit-app
          port: 80
